import{_ as s,o as n,c as a,S as l}from"./chunks/framework.31056c87.js";const F=JSON.parse('{"title":"C/C++ Addons","description":"","frontmatter":{},"headers":[],"relativePath":"guide/cpp-addons.md","filePath":"guide/cpp-addons.md"}'),e={name:"guide/cpp-addons.md"},p=l(`<h1 id="c-c-addons" tabindex="-1">C/C++ Addons <a class="header-anchor" href="#c-c-addons" aria-label="Permalink to &quot;C/C++ Addons&quot;">â€‹</a></h1><p>The <code>C/C++</code> addons of Node.js has a very notable feature, it only supports building in the <code>CommonJS</code> format, and using <code>require()</code> to load it. This is fatal to bundler like <a href="https://vitejs.dev/" target="_blank" rel="noreferrer">Vite</a>, <a href="https://rollupjs.org/" target="_blank" rel="noreferrer">Rollup</a> that strongly rely on the <code>ESModule</code> format.</p><p>Although there are tool plugins like <a href="https://www.npmjs.com/package/@rollup/plugin-commonjs" target="_blank" rel="noreferrer">@rollup/plugin-commonjs</a>, it is not a panacea, especially in some dynamic-require cases. This is also the biggest difference between <code>cjs</code> and <code>esm</code>.</p><p>So, many times we have to use the <code>external</code> option to exclude <code>C/C++</code> addons builds to ensure that it can work normally.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Of course, this is not absolute. If you are familiar with Vite, Rollup how works, and how <code>C/C++</code> addons are binding, then I believe you have better ways to deal with them.</p><p>Additionally, some samples for <code>C/C++</code> addons are provided here ğŸ‘‰ <a href="https://github.com/caoxiemeihao/electron-vite-samples" target="_blank" rel="noreferrer">electron-vite-samples</a>.</p></div><details><summary>ä¸­æ–‡</summary><p>Node.js çš„ <code>C/C++</code> æ‰©å±•æœ‰ä¸ªå¾ˆæ˜¾è‘—çš„ç‰¹ç‚¹ï¼Œå®ƒåªæ”¯æŒæ„å»ºæˆä¸º <code>CommonJS</code> æ ¼å¼çš„æ¨¡å—ï¼Œå¹¶ä¸”ä½¿ç”¨ <code>require()</code> åŠ è½½å®ƒã€‚è¿™å¯¹å¼ºä¾èµ– <code>ESModule</code> æ ¼å¼çš„æ„å»ºå·¥å…·åƒ Viteã€Rollup ååˆ†çš„è‡´å‘½ã€‚</p><p>è™½ç„¶æœ‰ <a target="_blank" href="https://www.npmjs.com/package/@rollup/plugin-commonjs">@rollup/plugin-commonjs</a> è¿™æ ·çš„å·¥å…·æ’ä»¶ï¼Œä½†å®ƒä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå°¤å…¶æ˜¯åœ¨ä¸€äº›åŠ¨æ€åŠ è½½çš„åœºæ™¯ï¼Œè¿™åŒæ ·ä¹Ÿæ˜¯ <code>cjs</code> ä¸ <code>esm</code> æœ€å¤§çš„ä¸åŒç‚¹ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¸å¾—ä¸ä½¿ç”¨ <code>external</code> é€‰é¡¹æ’é™¤ <code>C/C++</code> æ¨¡å—æ„å»ºï¼Œä»¥ä¿éšœå®ƒèƒ½æ­£å¸¸å·¥ä½œã€‚</p><p>å½“ç„¶ï¼Œè¿™ä¸æ˜¯ç»å¯¹çš„ã€‚å¦‚æœä½ å¾ˆç†Ÿæ‚‰ Viteã€Rollup çš„å·¥ä½œåŸç†å’Œ <code>C/C++</code> æ¨¡å—çš„ <code>binding</code> æ–¹å¼ï¼Œé‚£ä¹ˆæˆ‘ç›¸ä¿¡ä½ æœ‰æ›´å¥½çš„åŠæ³•å¤„ç†å®ƒä»¬ã€‚</p><p>æ­¤å¤–ï¼Œè¿™é‡Œæä¾›äº†ä¸€äº› <code>C/C++</code> æ¨¡å—çš„æ¨¡æ¿ ğŸ‘‰ <a target="_blank" href="https://github.com/caoxiemeihao/electron-vite-samples">electron-vite-samples</a>ã€‚</p></details><h2 id="example" tabindex="-1">Example <a class="header-anchor" href="#example" aria-label="Permalink to &quot;Example&quot;">â€‹</a></h2><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> electron </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-electron</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">electron</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// Main process entry file of the Electron App.</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">electron/main/index.ts</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">vite</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">rollupOptions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">external</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">better-sqlite3</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sqlite3</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">serialport</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">              </span><span style="color:#676E95;font-style:italic;">// other \`C/C++\` addons</span></span>
<span class="line"><span style="color:#A6ACCD;">            ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="vite-plugin-native" tabindex="-1">vite-plugin-native <a class="header-anchor" href="#vite-plugin-native" aria-label="Permalink to &quot;vite-plugin-native&quot;">â€‹</a></h2><p>In addition, you can also try to use the community plugin <a href="https://www.npmjs.com/package/vite-plugin-native" target="_blank" rel="noreferrer">vite-plugin-native</a> to load <code>C/C++</code> addons.</p><details><summary>ä¸­æ–‡</summary><p>å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨ç¤¾åŒºæ’ä»¶ <a target="_blank" href="https://www.npmjs.com/package/vite-plugin-native">vite-plugin-native</a> åŠ è½½ <code>C/C++</code> æ‰©å±•ã€‚</p></details><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> electron </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-electron</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> native </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-native</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">electron</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">electron/main.ts</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">vite</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#82AAFF;">native</span><span style="color:#A6ACCD;">(</span><span style="color:#676E95;font-style:italic;">/* options */</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div>`,12),o=[p];function t(r,c,i,D,y,d){return n(),a("div",null,o)}const u=s(e,[["render",t]]);export{F as __pageData,u as default};
